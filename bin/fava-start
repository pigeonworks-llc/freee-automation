#!/usr/bin/env bash
#
# Fava Web UI Startup Script
# Fava WebUIã®èµ·å‹•ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
#
# Usage:
#   fava-start [port]
#
# Default port: 5000

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
BEANCOUNT_FILE="$PROJECT_ROOT/beancount/main.beancount"

PORT="${1:-5000}"

# Check if Beancount file exists
if [ ! -f "$BEANCOUNT_FILE" ]; then
    echo "âŒ Error: Beancount file not found: $BEANCOUNT_FILE"
    exit 1
fi

# Validate Beancount syntax before starting Fava
echo "ğŸ” Validating Beancount syntax..."
if ! bean-check "$BEANCOUNT_FILE"; then
    echo "âŒ Error: Beancount validation failed"
    echo "Please fix syntax errors before starting Fava"
    exit 1
fi

echo "âœ… Beancount validation passed"
echo ""
echo "ğŸš€ Starting Fava on port $PORT..."
echo "ğŸ“Š Dashboard: http://localhost:$PORT"
echo ""
echo "Press Ctrl+C to stop Fava"
echo ""

# Start Fava
fava "$BEANCOUNT_FILE" --port "$PORT" --host 127.0.0.1
